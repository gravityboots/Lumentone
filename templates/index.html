<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Lumentone</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="icon" type="image/svg+xml" href="/assets/waveform-black.svg">
	<link rel="icon" type="image/svg+xml" href="/assets/waveform-black.svg" media="(prefers-color-scheme: light)">
	<link rel="icon" type="image/svg+xml" href="/assets/waveform-white.svg" media="(prefers-color-scheme: dark)">
	<link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="text-light">
	<video id="bg-video" class="bg-video" autoplay muted loop playsinline aria-hidden="true">
		<source src="/assets/background.webm" type="video/webm">
	</video>
	<div class="container py-4 position-relative">
		<div class="title-bar mb-4">
			<div class="frost-card p-3 d-flex align-items-center justify-content-between shadow-sm">
				<div class="d-flex align-items-center gap-3">
					<span class="brand-mark" aria-hidden="true"></span>
					<div>
						<h1 class="mb-0 brand-gradient">Lumentone</h1>
						<p class="text-secondary mb-0">Emotion-based music, powered by expression + heart rate.</p>
					</div>
				</div>
			</div>
		</div>

		<div class="row g-4">
			<div class="col-lg-6">
				<div class="card frost-card shadow-sm border-0 h-100">
					<div class="card-body right-pane">
						<div class="ratio ratio-4x3 rounded overflow-hidden bg-black mb-3 position-relative" id="video-wrap">
							<img id="video" src="/video_feed" class="w-100 h-100 object-fit-cover" alt="Camera feed">
						</div>
						<div class="d-flex flex-wrap align-items-center gap-2 mb-2">
							<div class="d-flex gap-2 flex-grow-1">
								<button id="start-btn" class="btn btn-success btn-sm flex-fill">Start Capture</button>
								<button id="stop-btn" class="btn btn-outline-secondary btn-sm flex-fill">Stop</button>
							</div>
							<select id="camera-select" class="form-select form-select-sm" style="max-width: 200px; min-width: 160px;"></select>
						</div>
						<div class="mb-3" id="rppg-debug">
							<div class="d-flex justify-content-between align-items-center mb-2">
								<p class="text-secondary mb-0">rPPG heart rate (forehead ROI)</p>
								<span id="hr-live" class="badge text-bg-success">--</span>
							</div>
							<div class="border border-secondary border-opacity-25 rounded">
								<button class="btn btn-sm w-100 text-start d-flex justify-content-between align-items-center px-3 py-2" id="rppg-toggle" type="button">
									<span class="text-secondary">Show POS details</span>
									<span id="rppg-arrow">â–¼</span>
								</button>
								<div id="rppg-body" class="collapse px-3 pb-3 pt-1">
									<div class="row g-2 mb-2" id="rppg-stats">
										<div class="col-6">
											<small class="text-secondary">ROI POS</small>
											<div id="pos-value" class="fw-semibold">--</div>
										</div>
										<div class="col-6">
											<small class="text-secondary">rPPG HR</small>
											<div id="hr-live-text" class="fw-semibold">--</div>
										</div>
										<div class="col-4">
											<small class="text-secondary">Mean HR</small>
											<div id="hr-mean" class="fw-semibold">--</div>
										</div>
										<div class="col-4">
											<small class="text-secondary">Median HR</small>
											<div id="hr-median" class="fw-semibold">--</div>
										</div>
										<div class="col-4">
											<small class="text-secondary">Mode HR</small>
											<div id="hr-mode" class="fw-semibold">--</div>
										</div>
										<div class="col-4">
											<small class="text-secondary">Method</small>
											<div id="hr-method" class="fw-semibold">--</div>
										</div>
									</div>
									<div class="border border-secondary border-opacity-25 rounded bg-black bg-opacity-10 p-2">
										<img id="pos-plot" alt="POS signal plot" class="w-100 rounded" style="min-height:140px; object-fit:contain;">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="card frost-card shadow-sm border-0 h-100">
					<div class="card-body">
						<div class="d-flex justify-content-between align-items-start mb-3">
							<div>
								<p class="text-secondary mb-1">Detected mood</p>
								<div class="d-flex align-items-center gap-2">
									<span id="mood-icon" class="mood-icon" aria-hidden="true"></span>
									<h3 id="mood-label" class="mb-0">--</h3>
								</div>
							</div>
							<div class="text-end">
								<p class="text-secondary mb-1">Valence / Arousal</p>
								<h6 id="va-label" class="mb-0">--</h6>
							</div>
						</div>
						<div class="row g-3 align-items-center mb-3">
							<div class="col-12">
								<label class="form-label mb-1">Heart rate</label>
								<div class="d-flex align-items-center gap-3">
									<input type="range" min="50" max="140" value="80" id="heart-rate" class="form-range flex-grow-1">
									<span id="hr-value" class="badge text-bg-primary fs-6">80 bpm</span>
								</div>
							</div>
							<div class="col-12">
								<label class="form-label mb-1">Playlist length</label>
								<select id="playlist-mode" class="form-select form-select-sm">
									<option value="short" selected>Short (3-5 songs)</option>
									<option value="medium">Medium (6-10 songs)</option>
									<option value="long">Long (8-20 songs)</option>
								</select>
							</div>
						</div>
						<div class="mb-3">
							<p class="text-secondary mb-1">Suggested genres</p>
							<div id="genres" class="d-flex flex-wrap gap-2"></div>
						</div>
						<div class="d-flex gap-2 mb-3">
							<button id="generate-btn" class="btn btn-primary flex-grow-1">Generate Playlist</button>
							<button id="jump-btn" class="btn btn-outline-light">Jump In</button>
						</div>
						<hr class="border-secondary">
						<div class="d-flex flex-column" style="height: 55vh; min-height: 360px;">
							<div class="d-flex justify-content-between align-items-center mb-2">
								<p class="text-secondary mb-0">Playlist</p>
								<small id="playlist-meta" class="text-secondary">--</small>
							</div>
							<div class="flex-grow-1 overflow-auto rounded border border-secondary border-opacity-25 bg-black bg-opacity-10" id="playlist-container">
								<div id="playlist" class="list-group list-group-flush"></div>
							</div>
							<div class="preview-wrap">
								<div class="mt-3 p-2 rounded bg-black bg-opacity-25">
									<p class="text-secondary mb-1">Preview player</p>
									<audio id="preview-player" class="w-100" controls preload="none"></audio>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/static/js/app.js"></script>
</body>
</html>
